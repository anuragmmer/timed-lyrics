# Timed Transcription and Lyrics Integration

This repository contains two scripts: a Python script (`transcribe.py`) for transcribing audio files into timed text format, and a JavaScript (JSX) script (`timedLyrics.jsx`) that generates timed text layers for use in Adobe After Effects. The tools make it easier to handle large transcription tasks and speed up video post-production, especially for lyric videos or time-coded captions. 

## Overview

1. **Python Script: `transcribe.py`**
    - This script utilizes the Whisper AI model to transcribe audio files with precise word-level timestamps.
    - It generates a formatted transcription where each line contains the start and end times of the spoken words.
    - These transcriptions can sync with video editing software or subtitles.

2. **JSX Script: `timedLyrics.jsx`**
    - This script is used within Adobe After Effects to automatically create timed text layers based on transcriptions.
    - It reads a transcription file, extracts the text and timestamps, and inserts the corresponding text into After Effects compositions.
    - Useful for creating animated lyric videos or synchronized captions in After Effects.

## Setup and Usage

### Python Script (`transcribe.py`)

This script requires Python and the Whisper AI library to run.

### Requirements

1. Install Whisper using:
   ```bash
   pip install git+https://github.com/openai/whisper.git
   ```

2. You also need the following Python libraries:
   - `tkinter` (for file selection)
   - `numpy`

   Install them using:
   ```bash
   pip install numpy
   ```

### How It Works

1. **Select an Audio File**: The script opens a file dialog allowing you to select an audio file in `.mp3`, `.wav`, or other formats.
2. **Transcription**: The Whisper model is used to transcribe the selected audio file with word-level timestamps.
3. **Output**: The transcribed text is formatted into lines where each line has start and end timestamps:
   ```
   [00:13.719 --> 00:17.379] I'm sorry, I don't want to be an imprint.
   ```

4. **Duplicate Removal**: The script also removes any duplicate lines to avoid redundancy in the transcription.

### Running the Script

Run the Python script with:
```bash
python transcribe.py
```

A file dialog will pop up, and you can choose the audio file you wish to transcribe. The script will output the transcription in a timestamped format.

### Key Functions

- `select_audio_file()`: Opens a file dialog to select the audio file.
- `format_timestamp(seconds)`: Formats the time in minutes, seconds, and milliseconds.
- `transcribe_music_with_precise_timing(file_path)`: Uses Whisper to transcribe the file and processes the transcription into timestamped lines.

---

### JSX Script (`timedLyrics.jsx`)

This script is designed to run inside Adobe After Effects to automate the process of creating text layers based on transcriptions with specific timings.

### How It Works

1. **Load Transcription File**: The script reads the transcription file, which contains lines formatted like:
   ```
   [00:13.719 --> 00:17.379] I'm sorry, I don't want to be an imprint.
   ```
2. **Extract Timestamps and Text**: It uses regular expressions to extract the start time, end time, and the corresponding text for each line.
3. **Create Text Layers**: For each line, a new text layer is added to the selected composition in After Effects. The layer's duration is determined by the start and end times in the transcription.
4. **Customize Appearance**: The script allows you to customize the text properties, such as font size and color.

### Key Functions

- `timeToSeconds(timeString)`: Converts time in the format `00:13.719` to seconds for After Effects.
- `createTimedTextFromFile()`: Reads the transcription file, parses each line, and creates the corresponding text layers in the After Effects composition.

### Usage

1. Copy the `timedLyrics.jsx` script to the After Effects Scripts folder or wherever you like.
2. Open After Effects and load your project.
3. Run the script by navigating to `File > Scripts > Run Script File`.
4. Select the transcription file when prompted.
5. The script will create timed text layers in your selected composition based on the transcription.

---

## Example

**Transcription Example** (generated by `transcribe.py`):
```
[00:13.719 --> 00:17.379] I'm sorry, I don't want to be an imprint.
```

**After Effects Result**: 
- A text layer will be created with the text "I'm sorry, I don't want to be an imprint." visible from `00:13.719` to `00:17.379` in the composition.

## Notes

- Make sure you have a composition selected in After Effects before running the JSX script.
- The Python script uses the medium-sized Whisper model for better transcription accuracy, but you can change the model if needed.
- Both scripts handle large files efficiently, with duplicate removal and optimal performance considerations.
- The Whisper model will be downloaded on your system first ~ 1.2GB. [Learn More](https://github.com/openai/whisper)


